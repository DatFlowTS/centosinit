#!/bin/zsh

dnf -y install breeze-gtk-common &>> $LOGFILE
dnf -y groupinstall --allowerasing --best --skip-broken "KDE Plasma Workspaces" "base-x" &>> $LOGFILE
dnf -y remove pulseaudio &>> $LOGFILE
echo "exec /usr/bin/startkde" >> ~/.xinitrc
echo "exec /usr/bin/startkde" >> /etc/skel/.xinitrc
systemctl set-default graphical.target
dnf -y install yakuake
read -p "Enable VNC Access on Port 5901 for $NEWUSER? (Y/N, default N) => " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    dnf -y install tigervnc-server &>> $LOGFILE
    cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service &>> $LOGFILE
    echo ":1=$NEWUSER" >> /etc/tigervnc/vncserver.users
    firewall-cmd --add-service=vnc-server &>> $LOGFILE
    firewall-cmd --permanent --add-service=vnc-server &>> $LOGFILE
    firewall-cmd --reload &>> $LOGFILE
    systemctl daemon-reload &>> $LOGFILE
    systemctl enable --now vncserver@:1.service
    echo '#######################################################'
    echo '#######################################################'
    echo '#######################################################'
    echo
    echo "VNC-Server and Service is enabled for $NEWUSER"
    echo "don't forget to set passwd and vncpasswd for that user"
    echo
    echo '#######################################################'
    echo '#######################################################'
    echo '#######################################################'
fi
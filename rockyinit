#!/bin/bash

export LOGFILE="$HOME/init_$(date +%F).log"

dnf -y install https://pkgs.dyn.su/el9/base/x86_64/raven-release-1.0-4.el9.noarch.rpm
dnf -y config-manager --set-enabled {crb,baseos,appstream,extras,plus,raven,raven-{extras,modular,multimedia}}
dnf -y install epel-release dnf-plugins-core gcc-c++
dnf -y install https://rpms.remirepo.net/enterprise/remi-release-9.rpm
dnf -y config-manager --set-enabled {epel,epel-modular}
dnf -y update && dnf -y upgrade --refresh
dnf -y install wget make vim  cockpit cockpit-{packagekit,sosreport,storaged,networkmanager,selinux,kdump}
dnf install -y https://github.com/45Drives/cockpit-navigator/releases/download/v0.5.10/cockpit-navigator-0.5.10-1.el8.noarch.rpm
systemctl enable --now cockpit.socket
curl -s https://packagecloud.io/install/repositories/ookla/speedtest-cli/script.rpm.sh | sudo bash
curl -sL https://rpm.nodesource.com/setup_current.x | sudo -E bash -
systemctl daemon-reload
sudo curl -s https://raw.githubusercontent.com/dylanaraps/neofetch/master/neofetch -o /usr/bin/neofetch
chmod 555 /usr/bin/neofetch
dnf -y update && dnf -y upgrade --refresh --best
dnf -y install git fuse-sshfs nodejs zsh python2 python36 speedtest
sudo alternatives --set python /usr/bin/python3
npm i -g npm
npm i -g typescript pm2
sed -i 's/bash/zsh/g' /etc/default/useradd
usermod --shell /bin/zsh root
read -p "Disable root login and password auth for SSH? (Y/N, default N) => " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/g' /etc/ssh/sshd_config
    sed -i 's/PermitRootLogin yes/PermitRootLogin no/g' /etc/ssh/sshd_config
    sed -i 's/#PasswordAuthentication/PasswordAuthentication/g' /etc/ssh/sshd_config
    sed -i 's/#PermitRootLogin/PermitRootLogin/g' /etc/ssh/sshd_config
else
    echo "Kept current configuration. Proceeding to next steps."
fi
cd ~
sh -c "$(curl -fsSL https://raw.github.com/datflowts/centosinit/master/zshinit-w)"
